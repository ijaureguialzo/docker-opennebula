---
- name: Comprobar los hosts disponibles
  hosts: all
  gather_facts: false
  tasks:
    - ansible.builtin.command: timeout 20 sh -c 'until nc -z $0 $1; do sleep 1; done' {{ inventory_hostname }} 22
      delegate_to: localhost
      register: ping_result
      ignore_errors: true
    - ansible.builtin.group_by: key=reachable
      when: ping_result is success

- name: Configurar el servidor
  hosts: reachable
  vars:
    ansible_python_interpreter: auto_silent
  gather_facts: true
  roles:
    - { role: actualizar, become: true }
    - { role: usuario, become: true }
    - { role: docker, become: true }
    - { role: extras, become: true }
